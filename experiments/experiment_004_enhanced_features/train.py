#!/usr/bin/env python3
"""
Experiment #004: 117ç‰¹å¾å¢å¼ºç³»ç»Ÿ
è®­ç»ƒè„šæœ¬ - è°ƒç”¨ä¸»è®­ç»ƒç¨‹åºæµ‹è¯•117ä¸ªä¸“ä¸šå¤–æ±‡ç‰¹å¾

å®éªŒç›®æ ‡:
- éªŒè¯ä»3ç‰¹å¾åˆ°117ç‰¹å¾çš„é©å‘½æ€§æ€§èƒ½çªç ´
- æµ‹è¯•é«˜ç»´ç‰¹å¾ç©ºé—´çš„è®­ç»ƒç¨³å®šæ€§
- ç»“åˆforex_optimizedå¥–åŠ±å‡½æ•°çš„æœ€ä½³é…ç½®
"""

import subprocess
import sys
import os

def main():
    print("=" * 60)
    print("EXPERIMENT #004: 117ç‰¹å¾å¢å¼ºç³»ç»Ÿ")
    print("ç›®æ ‡: éªŒè¯117ä¸ªä¸“ä¸šå¤–æ±‡ç‰¹å¾çš„æ€§èƒ½çªç ´")
    print("=" * 60)
    
    # åˆ‡æ¢åˆ°é¡¹ç›®æ ¹ç›®å½•
    root_dir = os.path.join(os.path.dirname(__file__), '..', '..')
    os.chdir(root_dir)
    
    # å®éªŒå‚æ•°é…ç½® - ä½¿ç”¨train_model.pyæ”¯æŒçš„å‚æ•° (GPUå¤šçº¿ç¨‹ä¼˜åŒ–)
    params = [
        sys.executable, "train_model.py",
        "--symbol", "EURUSD",
        "--data-dir", "datasets/EURUSD_20250811_174255",  # ä½¿ç”¨117ç‰¹å¾æ•°æ®é›†
        "--use-all-features",  # ğŸ”¥ å…³é”®å‚æ•°ï¼šä½¿ç”¨æ‰€æœ‰117ä¸ªç‰¹å¾
        "--iterations", "300",  # å……åˆ†çš„è®­ç»ƒè½®æ¬¡
        "--reward-type", "forex_optimized",  # ç»“åˆå·²éªŒè¯çš„å¥–åŠ±å‡½æ•°
        "--timesteps-total", "3000000",  # å®Œæ•´è®­ç»ƒæ­¥æ•°
        "--enable-visualization",
        "--visualization-freq", "15000",
        # GPUå¤šç¯å¢ƒå¹¶è¡Œä¼˜åŒ–é…ç½®
        "--n-envs", "4",  # 4ä¸ªå¹¶è¡Œç¯å¢ƒå……åˆ†åˆ©ç”¨RTX 4080
        "--num-threads", "4",  # 4ä¸ªæ•°æ®åŠ è½½çº¿ç¨‹
        "--verbose"
    ]
    
    print(f"å®éªŒé…ç½®:")
    print(f"   Symbol: EURUSD")
    print(f"   Algorithm: PPO")
    print(f"   Reward: forex_optimized")
    print(f"   Timesteps: 3,000,000")
    print(f"   Features: 117ä¸ªä¸“ä¸šå¤–æ±‡ç‰¹å¾")
    print(f"   GPUä¼˜åŒ–: 4å¹¶è¡Œç¯å¢ƒ + 4çº¿ç¨‹ (RTX 4080ä¼˜åŒ–)")
    print(f"   Target: 117ç‰¹å¾GPUè®­ç»ƒ")
    print()
    
    print("117ç‰¹å¾ç³»ç»Ÿæ„æˆ:")
    print("   åŸºç¡€ç§»åŠ¨å¹³å‡: 10ä¸ªæŒ‡æ ‡ (å¤šå‘¨æœŸSMA/EMA)")
    print("   é«˜çº§æŠ€æœ¯æŒ‡æ ‡: 25ä¸ªæŒ‡æ ‡ (ADX, Parabolic SAR, Ichimoku)")
    print("   æ³¢åŠ¨æ€§åˆ†æ: 15ä¸ªæŒ‡æ ‡ (å¤šå‘¨æœŸATR, å†å²æ³¢åŠ¨ç‡)")
    print("   å¤šæ—¶é—´æ¡†æ¶: 30ä¸ªæŒ‡æ ‡ (5åˆ†é’Ÿåˆ°æ—¥çº¿)")
    print("   å¸‚åœºå¾®è§‚ç»“æ„: 20ä¸ªæŒ‡æ ‡ (æ”¯æ’‘é˜»åŠ›, çªç ´ä¿¡å·)")
    print("   ç»Ÿè®¡æ•°å­¦ç‰¹å¾: 17ä¸ªæŒ‡æ ‡ (æ»šåŠ¨ç»Ÿè®¡, åˆ†å¸ƒåˆ†æ)")
    print(f"   æ€»è®¡: 117ä¸ªä¸“ä¸šå¤–æ±‡ç‰¹å¾ (vs ä¹‹å‰3ä¸ª)")
    print()
    
    print("å¼€å§‹117ç‰¹å¾é©å‘½è®­ç»ƒ...")
    print("   é¢„è®¡æ—¶é—´: ~4-6å°æ—¶ (å®Œæ•´è®­ç»ƒ)")
    print("   é‡ç‚¹ç›‘æ§: é«˜ç»´è®­ç»ƒç¨³å®šæ€§å’Œæ”¶æ•›è´¨é‡")
    print("   æœŸæœ›æˆæœ: ç›¸æ¯”3ç‰¹å¾ç³»ç»Ÿ100-300%æ€§èƒ½çªç ´")
    print("   é‡Œç¨‹ç¢‘: TensorTradeé¦–æ¬¡çªç ´100+ç‰¹å¾æ·±åº¦è®­ç»ƒ")
    print()
    
    print("è®­ç»ƒç›‘æ§é‡ç‚¹:")
    print("   æ”¶æ•›ç¨³å®šæ€§ (é«˜ç»´ç©ºé—´æŒ‘æˆ˜)")
    print("   æ¢¯åº¦å¥åº·åº¦ (é¿å…æ¢¯åº¦æ¶ˆå¤±/çˆ†ç‚¸)")
    print("   è¿‡æ‹Ÿåˆç›‘æ§ (117ç‰¹å¾é£é™©)")
    print("   ç‰¹å¾æœ‰æ•ˆæ€§éªŒè¯")
    print()
    
    try:
        # æ‰§è¡Œè®­ç»ƒ
        result = subprocess.run(params, check=True, capture_output=False)
        
        print("\n" + "=" * 60)
        print("EXPERIMENT #004 è®­ç»ƒå®Œæˆ!")
        print("=" * 60)
        print("117ç‰¹å¾é©å‘½è®­ç»ƒæˆåŠŸ!")
        print("   é«˜ç»´ç‰¹å¾ç©ºé—´è®­ç»ƒå®Œæˆ")
        print("   ä¸“ä¸šå¤–æ±‡æŒ‡æ ‡å…¨é¢é›†æˆ")
        print("   é¢„æœŸå¸¦æ¥å†å²æ€§æ€§èƒ½çªç ´")
        print()
        print("117ç‰¹å¾ç³»ç»Ÿä»·å€¼:")
        print("   ä¿¡æ¯é‡æå‡: ~30-40å€")
        print("   å¸‚åœºç†è§£åŠ›: ä¸“ä¸šäº¤æ˜“å‘˜çº§åˆ«")
        print("   ä¿¡å·è´¨é‡: æ˜¾è‘—æå‡")
        print("   é€‚åº”æ€§: å¤šå¸‚åœºç¯å¢ƒé€‚åº”")
        print("   é¢„æœŸRewardæå‡: 100-300%")
        print()
        print("ç‰¹å¾ç³»ç»Ÿé‡Œç¨‹ç¢‘:")
        print("   Phase 1: 3ä¸ªåŸºç¡€ç‰¹å¾ (å·²å®Œæˆ)")
        print("   Phase 2: å¯è§†åŒ–é›†æˆ (å·²å®Œæˆ)")
        print("   Phase 3: 117ä¸ªä¸“ä¸šç‰¹å¾ (åˆšå®Œæˆ!)")
        print("   Phase 4: ç‰¹å¾ä¼˜åŒ–è°ƒä¼˜ (ä¸‹ä¸€æ­¥)")
        print()
        print("ä¸‹ä¸€æ­¥å…³é”®ä»»åŠ¡:")
        print("   1. ç«‹å³è¿è¡Œ evaluate.py éªŒè¯æ€§èƒ½çªç ´")
        print("   2. åˆ†æ117ç‰¹å¾çš„å®é™…æ”¹è¿›å¹…åº¦")
        print("   3. ä¸æ‰€æœ‰å‰æœŸå®éªŒè¿›è¡Œæ€§èƒ½å¯¹æ¯”")
        print("   4. ç¡®è®¤æ˜¯å¦è¾¾åˆ°ä¸“ä¸šäº¤æ˜“çº§åˆ«")
        print()
        print("å†å²æ„ä¹‰:")
        print("   TensorTradeç³»ç»Ÿé¦–æ¬¡çªç ´100+ç‰¹å¾")
        print("   ä»æ¦‚å¿µéªŒè¯æå‡åˆ°ä¸“ä¸šçº§ç³»ç»Ÿ")
        print("   å»ºç«‹äº†å¤–æ±‡RLäº¤æ˜“çš„æ–°æ ‡å‡†")
        print("   ä¸ºå­¦æœ¯ç ”ç©¶æä¾›äº†é‡è¦åŸºç¡€")
        
        return True
        
    except subprocess.CalledProcessError as e:
        print(f"\nè®­ç»ƒå¤±è´¥: {e}")
        print("å¯èƒ½çš„é—®é¢˜:")
        print("   1. 117ç‰¹å¾æ•°æ®é›†ä¸å­˜åœ¨æˆ–æŸå")
        print("   2. å†…å­˜ä¸è¶³æ”¯æŒé«˜ç»´è®­ç»ƒ")
        print("   3. å­¦ä¹ ç‡ç­‰å‚æ•°éœ€è¦è¿›ä¸€æ­¥è°ƒæ•´")
        print("   4. è®­ç»ƒæ—¶é—´ä¸è¶³ï¼Œé«˜ç»´ç©ºé—´éœ€è¦æ›´å¤šæ—¶é—´")
        return False
    except Exception as e:
        print(f"\næ‰§è¡Œé”™è¯¯: {e}")
        return False

if __name__ == "__main__":
    success = main()
    sys.exit(0 if success else 1)