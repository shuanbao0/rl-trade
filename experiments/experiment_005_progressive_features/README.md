# Experiment #005: 渐进式特征选择系统

## 实验概述

实验005旨在解决实验004暴露的关键问题：
- **维数灾难**：117特征导致过拟合
- **奖励-回报不一致**：奖励+94542但回报-43.69%  
- **特征质量未验证**：缺乏科学的特征选择方法

## 核心改进

### 1. 渐进式特征增长
- 阶段1：3个基础特征（基准）
- 阶段2：10个科学选择特征  
- 阶段3：20个最优特征组合

### 2. OptimizedForexReward奖励函数
- 确保奖励-回报相关性>0.8
- 实时监控一致性
- 外汇交易专门优化

### 3. FeatureEvaluator科学评估
- 6维评估体系：性能、显著性、重要性、冗余度、成本、理论
- 统计显著性检验（p值<0.05）
- 效应大小验证（>0.2）

## 使用方法

### 快速开始
```bash
# 1. 训练所有阶段
cd experiments/experiment_005_progressive_features
python train.py

# 2. 评估结果  
python evaluate.py
```

### 详细执行步骤

#### 阶段1：基准训练（3特征）
```bash
python train.py  # 自动执行阶段1
```
- 使用基础特征：Close, SMA_14, RSI_14
- 建立性能基准
- 训练100轮

#### 阶段2：扩展训练（10特征）  
```bash
# train.py会自动继续执行阶段2
```
- 基于FeatureEvaluator选择最优7个附加特征
- 训练120轮
- 验证渐进改进效果

#### 阶段3：最优训练（20特征）
```bash
# train.py会自动继续执行阶段3
```
- 最终20个特征的最优组合
- 训练150轮
- 达到性能-复杂度最佳平衡

### 评估分析
```bash
python evaluate.py
```
- 对比3→10→20特征的性能变化
- 验证奖励-回报一致性
- 生成详细分析报告

## 文件结构

```
experiments/experiment_005_progressive_features/
├── train.py              # 主训练脚本
├── evaluate.py           # 评估脚本  
├── experiment_config.json # 详细配置
├── README.md             # 本文档
└── models/               # 训练模型存储
    ├── stage1_3features/
    ├── stage2_10features/
    └── stage3_20features/
```

## 核心特性

### 🔬 科学方法论
- **统计显著性**：每个特征p值<0.05
- **效应大小**：确保实际改进>0.2  
- **6维评估**：全面的特征质量评估
- **渐进验证**：每阶段独立验证

### ⚡ 技术优化
- **避免维数灾难**：20特征 vs 117特征
- **奖励一致性**：相关性>0.8保证
- **训练效率**：分阶段训练更快收敛
- **数值稳定性**：完善的异常处理

### 📊 实验控制
- **对照实验**：与实验004全面对比
- **重现性**：固定随机种子
- **可追溯**：完整的实验日志
- **自动化**：脚本化执行流程

## 预期成果

### 相比实验004的改进
- ✅ **解决维数灾难**：从117降至20特征
- ✅ **解决奖励不一致**：OptimizedForexReward确保一致性
- ✅ **科学特征选择**：统计显著性保证质量
- ✅ **稳定性能**：避免过拟合，泛化能力更强

### 性能目标
- **训练稳定性**：避免高维空间训练困难
- **奖励一致性**：解决+94542奖励vs-43.69%回报矛盾
- **特征效率**：每个特征都有统计意义
- **可解释性**：清晰的特征选择依据

## 技术细节

### OptimizedForexReward配置
```json
{
  "return_weight": 1.0,
  "risk_penalty": 0.1,
  "transaction_cost": 0.0001,
  "correlation_threshold": 0.8,
  "stability_window": 20
}
```

### FeatureEvaluator权重
```json
{
  "performance": 0.30,
  "significance": 0.20, 
  "importance": 0.20,
  "redundancy": 0.15,
  "cost": 0.10,
  "theory": 0.05
}
```

## 故障排除

### 常见问题
1. **模型文件未找到**：确保train.py成功完成
2. **数据不存在**：运行`python download_data.py --symbol EURUSD=X --period 2y`
3. **内存不足**：减少并行环境数量
4. **训练失败**：检查日志文件，调整学习率

### 日志位置
- 训练日志：`logs/`目录
- 评估报告：`evaluate.py`生成的详细报告
- 模型检查点：`models/`对应阶段目录

## 科学贡献

### 方法论创新
- **渐进式特征选择**：避免一次性高维训练
- **统计验证标准**：p值和效应大小双重保证
- **奖励一致性监控**：实时确保训练有效性  
- **多阶段验证**：建立清晰的改进证据链

### 实践价值
- 为高维特征工程提供科学方法
- 解决强化学习中的维数灾难
- 建立外汇交易的特征选择标准
- 提供可复制的实验流程

---

*Experiment #005 - 科学解决实验004问题，建立特征工程新标准*